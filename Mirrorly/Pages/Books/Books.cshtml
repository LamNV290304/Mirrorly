@page "{serviceId:int}"
@model Mirrorly.Pages.Books.BookingModel
@{
}

<section class="booking-wrapper">
	<div class="booking-form-col">
		<h2>Đặt Lịch Makeup</h2>
		@if (!string.IsNullOrEmpty(Model.StatusMessage))
		{
			var cssClass = Model.StatusMessage.Contains("✅") ? "alert-success" : "alert-error";

			<div class="@cssClass">
				@Model.StatusMessage
			</div>
		}

		<form method="post" class="booking-form">
			<div class="form-group">
				<input type="tel" id="Muaid" name="Muaid" required hidden value="@Model.MuaProfile.Muaid" />
			</div>
			<div class="form-group">
				<label for="Name">Họ và Tên</label>
				<input type="text" id="Name" name="Name" required value="@Model.LoggedUser.FullName" />
			</div>

			<div class="form-group">
				<label for="Phone">Số Điện Thoại</label>
				<input type="tel" id="Phone" name="Phone" required value="@Model.LoggedUser.PhoneNumber" />
			</div>

			<div class="form-group">
				<label for="Date">Ngày</label>
				<input type="date" id="Date" name="Date" required
					   min="@DateTime.Now.ToString("yyyy-MM-dd")" />
			</div>

			<div class="form-group">
				<label for="Time">Giờ hẹn:</label>
				<input type="time" id="Time" name="Time" required />
			</div>
			<div class="form-group">
				<label for="Time">Địa chỉ:</label>
				<input type="text" id="Address" name="Address" required />
			</div>

			<div class="form-group service-group">
				<label for="Service">Chọn Gói Makeup</label>
				<div class="service-wrapper">
					<select id="Service" name="Service" required>
						@if (Model.Services != null)
						{
							<option value="@Model.Services.ServiceId"
									data-price="@Model.Services.BasePrice"
									selected>
								@Model.Services.Name
							</option>
						}
						@if (Model.MuaProfile?.Services != null)
						{
							foreach (var service in Model.MuaProfile.Services)
							{
								// Tránh hiển thị trùng service đang chọn
								if (Model.Services == null || service.ServiceId != Model.Services.ServiceId)
								{
									<option value="@service.ServiceId" data-price="@service.BasePrice">
										@service.Name
									</option>
								}
							}
						}
					</select>


					<input type="text" id="ServicePrice"
						   readonly placeholder="Giá dịch vụ"
						   value="@(Model.Services != null ? Model.Services.BasePrice.ToString("N0") + " đ" : "")" />

				</div>
			</div>

			<div class="form-group">
				<label for="Notes">Ghi chú (yêu cầu phong cách, dị ứng, thời gian…)</label>
				<textarea id="Notes" name="Notes" class="notes-textarea" rows="3"
						  placeholder="Ví dụ: makeup tự nhiên, đến sớm 15’..."></textarea>
			</div>

			<button type="submit" class="btn-submit">Xác Nhận Đặt Lịch</button>
		</form>
	</div>
	<div class="booking-artist-col">
		@if (Model.MuaUser.AvatarUrl != null){
			<img src="@Model.MuaUser.AvatarUrl" alt="Artist" class="artist-img" />
		}
		else
		{
			<img src="~/uploads/avatardefault.png" alt="Artist" class="artist-img" />
		}
		<h1>@Model.MuaProfile.DisplayName</h1>
		<h3>Kinh nghiệm: @Model.MuaProfile.ExperienceYears</h3>
	</div>

</section>

@section Scripts {
	<script>
		document.addEventListener("DOMContentLoaded", function () {
			const serviceSelect = document.getElementById("Service");
			const priceInput = document.getElementById("ServicePrice");

			serviceSelect.addEventListener("change", function () {
				const selectedOption = this.options[this.selectedIndex];
				const price = selectedOption.getAttribute("data-price");

				if (price) {
					priceInput.value = Number(price).toLocaleString('vi-VN') + " đ";
				} else {
					priceInput.value = "";
				}
			});
		});
	</script>
}
